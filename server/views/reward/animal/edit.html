<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <title>사례금 유기동물 특이사항 수정</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 30px;
        }

        h1 {
            font-size: 28px;
        }

        form label {
            display: block;
            margin: 10px 0 5px;
            font-weight: bold;
        }

        input[type="text"] {
            width: 300px;
            padding: 6px;
            font-size: 14px;
        }

        button {
            margin-top: 15px;
            padding: 6px 12px;
            font-size: 14px;
        }

        #result {
            margin-top: 20px;
        }
    </style>
</head>

<body>
    <h1>특이사항 수정</h1>

    <form id="edit-form">
        <label for="id">ID (수정 대상):</label>
        <input type="text" name="id" id="id" readonly>

        <label for="specialMark">특이사항:</label>
        <input type="text" name="specialMark" id="specialMark" required>

        <br>
        <button type="submit">수정하기</button>
    </form>

    <div id="result"></div>

    <script>
        const id = window.location.pathname.split('/').pop();

        const idInput = document.getElementById("id");
        const specialMarkInput = document.getElementById("specialMark");
        const resultDiv = document.getElementById("result");
        const form = document.getElementById("edit-form");

        // 기존 데이터 불러오기
        async function loadPostData() {
            try {
                const res = await fetch(`/api/reward/animal/detail/${id}`);
                const post = await res.json();

                if (!res.ok) throw new Error(post.error || "데이터를 불러올 수 없습니다.");
                idInput.value = post._id;
                specialMarkInput.value = post.specialMark || '';
            } catch (err) {
                resultDiv.innerHTML = `<p style="color:red">불러오기 오류: ${err.message}</p>`;
            }
        }

        loadPostData();

        // 수정 요청
        form.addEventListener("submit", async function (e) {
            e.preventDefault();
            const specialMark = specialMarkInput.value;

            try {
                const res = await fetch(`/api/reward/animal/edit/${id}?_method=PUT`, {
                    method: 'POST', // PUT 지원을 위해 method override 사용
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ specialMark })
                });

                const result = await res.json();
                if (res.ok) {
                    resultDiv.innerHTML = `
                        <p style="color:green">수정 완료!</p>
                        <a href="/reward/animal/detail/${id}">게시글로 돌아가기</a>`;
                } else {
                    resultDiv.innerHTML = `<p style="color:red">수정 실패: ${result.error || '알 수 없는 오류'}</p>`;
                }
            } catch (err) {
                resultDiv.innerHTML = `<p style="color:red">요청 실패: ${err.message}</p>`;
            }
        });
    </script>
</body>

</html>